
<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sürdürülebilir Akıllı Sınıf - Prototip</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #0a0f1d; color: #e2e8f0; }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .nfc-animation { animation: pulse-blue 2s infinite; }
        @keyframes pulse-blue {
            0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(59, 130, 246, 0); }
            100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
        }
        .view { display: none; }
        .view.active { display: block; animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="min-h-screen pb-20">

    <!-- Üst Menü -->
    <nav class="sticky top-0 z-50 p-4 glass mb-4">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center gap-2">
                <div class="w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center shadow-lg shadow-blue-900/40">
                    <i class="fas fa-leaf text-white text-xl"></i>
                </div>
                <div>
                    <h1 class="font-bold text-sm tracking-tight leading-none">AKILLI SINIF</h1>
                    <span class="text-[10px] text-blue-400 font-bold uppercase tracking-widest">Sürdürülebilir Prototip</span>
                </div>
            </div>
            <div class="flex gap-2">
                <button onclick="switchView('home')" class="p-2 px-4 rounded-lg bg-slate-800 text-xs font-bold hover:bg-slate-700 transition">ANA SAYFA</button>
                <button onclick="switchView('admin')" class="p-2 px-4 rounded-lg bg-slate-800 text-xs font-bold hover:bg-slate-700 transition">YÖNETİM</button>
            </div>
        </div>
    </nav>

    <div class="container mx-auto px-4 max-w-2xl">

        <!-- ANA SAYFA GÖRÜNÜMÜ -->
        <div id="home-view" class="view active space-y-6">
            
            <!-- Durum Kartı -->
            <div class="glass rounded-3xl p-8 text-center relative overflow-hidden">
                <div id="scan-indicator" class="w-32 h-32 rounded-full border-4 border-slate-700 flex items-center justify-center mx-auto mb-6 transition-all duration-500">
                    <i id="scan-icon" class="fas fa-fingerprint text-5xl text-slate-600"></i>
                </div>
                <h2 id="main-status" class="text-2xl font-extrabold mb-1">Sistem Kapalı</h2>
                <p id="sub-status" class="text-slate-400 text-sm mb-8">NFC taramasını başlatmak için butona dokunun.</p>
                
                <button id="nfc-trigger" class="w-full bg-blue-600 hover:bg-blue-500 py-4 rounded-2xl font-black text-white shadow-xl shadow-blue-900/20 active:scale-95 transition-all">
                    TARAMAYI BAŞLAT
                </button>
            </div>

            <!-- İstatistik Paneli -->
            <div class="grid grid-cols-2 gap-4">
                <div class="glass p-5 rounded-3xl border-l-4 border-blue-500">
                    <p class="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-1">Gelen Öğrenci</p>
                    <div class="flex items-baseline gap-1">
                        <span id="stat-present" class="text-3xl font-black text-white">0</span>
                        <span id="stat-total" class="text-slate-500 text-sm">/ 2</span>
                    </div>
                </div>
                <div class="glass p-5 rounded-3xl border-l-4 border-green-500">
                    <p class="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-1">Enerji Tasarrufu</p>
                    <div class="flex items-baseline gap-1">
                        <span id="stat-save" class="text-3xl font-black text-green-400">%0</span>
                    </div>
                </div>
            </div>

            <!-- Yoklama Listesi -->
            <div class="glass rounded-3xl overflow-hidden">
                <div class="p-4 border-b border-white/5 flex justify-between items-center bg-white/5">
                    <h3 class="text-xs font-bold uppercase tracking-widest">Giriş Kayıtları</h3>
                    <button onclick="resetAttendance()" class="text-[10px] bg-red-900/30 text-red-400 px-3 py-1 rounded-full font-bold hover:bg-red-900/50 transition">
                        Sıfırla
                    </button>
                </div>
                <div id="attendance-list" class="divide-y divide-white/5 max-h-60 overflow-y-auto">
                    <!-- Dinamik liste -->
                </div>
                <div id="empty-msg" class="p-10 text-center text-slate-500 text-sm italic">Henüz kimse giriş yapmadı.</div>
            </div>
        </div>

        <!-- YÖNETİM / VERİTABANI GÖRÜNÜMÜ -->
        <div id="admin-view" class="view space-y-6">
            <div class="glass rounded-3xl p-6">
                <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                    <i class="fas fa-database text-blue-500"></i> Manuel Veritabanı
                </h2>
                
                <!-- Öğrenci Ekleme Formu -->
                <div class="space-y-3 mb-8">
                    <input type="text" id="new-student-id" placeholder="NFC Okul No (örn: 167)" class="w-full bg-slate-900 border border-slate-700 rounded-xl px-4 py-3 outline-none focus:border-blue-500 transition">
                    <input type="text" id="new-student-name" placeholder="Ad Soyad" class="w-full bg-slate-900 border border-slate-700 rounded-xl px-4 py-3 outline-none focus:border-blue-500 transition">
                    <button onclick="addStudent()" class="w-full bg-green-600 hover:bg-green-500 py-3 rounded-xl font-bold transition">ÖĞRENCİ EKLE</button>
                </div>

                <hr class="border-white/5 mb-6">

                <h3 class="text-sm font-bold text-slate-400 mb-4 uppercase tracking-widest">Kayıtlı Öğrenciler</h3>
                <div id="db-list" class="space-y-2">
                    <!-- Kayıtlı öğrenciler listesi -->
                </div>
            </div>
        </div>

    </div>

    <!-- Hoş Geldin Modalı -->
    <div id="welcome-modal" class="fixed inset-0 bg-blue-600 z-[100] flex flex-col items-center justify-center text-white transform translate-y-full transition-transform duration-500 px-8 text-center">
        <div class="w-32 h-32 bg-white/20 rounded-full flex items-center justify-center mb-8 animate-bounce">
            <i class="fas fa-user-check text-6xl"></i>
        </div>
        <h2 class="text-6xl font-black mb-4 uppercase">HOŞ GELDİN</h2>
        <p id="student-name-popup" class="text-3xl font-medium"></p>
        <p class="mt-12 text-blue-200 text-sm tracking-widest uppercase">Giriş Saati Kaydedildi</p>
    </div>

    <script>
        // --- VERİ YÖNETİMİ ---
        let students = JSON.parse(localStorage.getItem('smart_classroom_db')) || {
            "167": { name: "Muhammed Emin Akman", present: false, time: null },
            "166": { name: "Mehmet Abay Kurban", present: false, time: null }
        };

        function saveDB() {
            localStorage.setItem('smart_classroom_db', JSON.stringify(students));
            renderLists();
        }

        // --- GÖRÜNÜM YÖNETİMİ ---
        function switchView(viewName) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById(viewName + '-view').classList.add('active');
        }

        // --- YOKLAMA MANTIĞI ---
        function processScan(id) {
            const studentId = String(id).trim();
            if (students[studentId]) {
                const s = students[studentId];
                if (!s.present) {
                    s.present = true;
                    s.time = new Date().toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' });
                    
                    // Görsel Feedback
                    triggerWelcome(s.name);
                    saveDB();
                } else {
                    announce(s.name + " zaten kayıtlı.");
                }
            } else {
                announce("Tanımsız kart okundu.");
            }
        }

        function triggerWelcome(name) {
            const modal = document.getElementById('welcome-modal');
            document.getElementById('student-name-popup').innerText = name;
            modal.classList.remove('translate-y-full');
            announce("Hoş geldin " + name);
            setTimeout(() => modal.classList.add('translate-y-full'), 3000);
        }

        function resetAttendance() {
            if(confirm("Tüm yoklamayı sıfırlamak istediğine emin misin?")) {
                Object.keys(students).forEach(id => {
                    students[id].present = false;
                    students[id].time = null;
                });
                saveDB();
            }
        }

        // --- VERİTABANI İŞLEMLERİ ---
        function addStudent() {
            const id = document.getElementById('new-student-id').value.trim();
            const name = document.getElementById('new-student-name').value.trim();
            
            if(id && name) {
                students[id] = { name: name, present: false, time: null };
                document.getElementById('new-student-id').value = '';
                document.getElementById('new-student-name').value = '';
                saveDB();
            }
        }

        function deleteStudent(id) {
            if(confirm(students[id].name + " kişisini silmek istediğine emin misin?")) {
                delete students[id];
                saveDB();
            }
        }

        // --- ARAYÜZ GÜNCELLEME ---
        function renderLists() {
            const attList = document.getElementById('attendance-list');
            const dbList = document.getElementById('db-list');
            const emptyMsg = document.getElementById('empty-msg');
            
            attList.innerHTML = '';
            dbList.innerHTML = '';
            
            let presentCount = 0;
            let totalCount = Object.keys(students).length;

            Object.keys(students).forEach(id => {
                const s = students[id];
                
                // Yoklama Listesi
                if(s.present) {
                    presentCount++;
                    const row = `
                        <div class="p-4 flex justify-between items-center bg-blue-500/5">
                            <div>
                                <p class="font-bold text-sm text-white">${s.name}</p>
                                <p class="text-[10px] text-slate-500 uppercase">Giriş: ${s.time}</p>
                            </div>
                            <span class="text-[10px] bg-green-500/20 text-green-400 px-2 py-1 rounded font-bold">GELDİ</span>
                        </div>
                    `;
                    attList.innerHTML += row;
                }

                // Yönetim Listesi
                const dbRow = `
                    <div class="flex justify-between items-center bg-slate-900 p-3 rounded-xl border border-white/5">
                        <div>
                            <p class="text-sm font-bold text-white">${s.name}</p>
                            <p class="text-xs text-slate-500">ID: ${id}</p>
                        </div>
                        <button onclick="deleteStudent('${id}')" class="text-red-500 hover:text-red-400 p-2"><i class="fas fa-trash"></i></button>
                    </div>
                `;
                dbList.innerHTML += dbRow;
            });

            document.getElementById('stat-present').innerText = presentCount;
            document.getElementById('stat-total').innerText = "/ " + totalCount;
            document.getElementById('stat-save').innerText = "%" + (presentCount * 12);
            emptyMsg.style.display = presentCount > 0 ? 'none' : 'block';
        }

        // --- NFC SİSTEMİ ---
        const nfcBtn = document.getElementById('nfc-trigger');
        nfcBtn.addEventListener('click', async () => {
            if (!('NDEFReader' in window)) {
                const id = prompt("Web NFC bu cihazda desteklenmiyor.\nTest için manuel ID girin (örn: 167):");
                if(id) processScan(id);
                return;
            }

            try {
                const ndef = new NDEFReader();
                await ndef.scan();
                
                nfcBtn.disabled = true;
                nfcBtn.innerText = "KART BEKLENİYOR...";
                nfcBtn.classList.replace('bg-blue-600', 'bg-slate-700');
                document.getElementById('scan-indicator').classList.add('nfc-animation', 'border-blue-500');
                document.getElementById('scan-icon').classList.replace('text-slate-600', 'text-blue-500');
                document.getElementById('main-status').innerText = "Tarama Aktif";
                document.getElementById('sub-status').innerText = "Lütfen kartı telefonun arkasına yaklaştırın.";

                ndef.onreading = event => {
                    const decoder = new TextDecoder();
                    for (const record of event.message.records) {
                        const content = decoder.decode(record.data);
                        processScan(content.trim());
                    }
                };
            } catch (error) {
                alert("NFC Hatası: " + error.message);
            }
        });

        // Yardımcılar
        function announce(text) {
            const msg = new SpeechSynthesisUtterance(text);
            msg.lang = 'tr-TR';
            window.speechSynthesis.speak(msg);
        }

        // Başlangıç
        renderLists();
    </script>
</body>
</html>